name: 🛠️ Workflow Syntax & Event Monitor

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'  # 매 시간마다 실행

jobs:
  validate-workflows:
    name: 🔍 Validate all workflows in .github/workflows
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4

      - name: 📁 Find all workflow files
        id: find_workflows
        run: |
          echo "files=$(find .github/workflows -type f \( -iname '*.yml' -o -iname '*.yaml' \) -print0 | xargs -0)" >> $GITHUB_OUTPUT

      - name: 🔎 Validate each workflow file
        run: |
          echo "🔍 GitHub Workflow Lint 시작"
          success=true
          for file in ${{ steps.find_workflows.outputs.files }}; do
            echo "⚙️ 파일 검사 중: $file"
            if ! act -j dummy -W "$file" --dryrun 2>&1 | tee tmp_result | grep -q 'Error'; then
              echo "✅ $file: 유효한 YAML"
            else
              echo "❌ $file: 오류 발생"
              success=false
              cat tmp_result
            fi
          done
          $success || exit 1
        env:
          ACT_LOG_LEVEL: debug

      - name: ✅ 보고서 출력
        if: success()
        run: echo "✅ 모든 워크플로우 파일이 유효합니다."

      - name: ⚠️ 오류 발생 시 경고
        if: failure()
        run: |
          echo "❌ 오류가 있는 워크플로우 파일이 존재합니다. 수정이 필요합니다."
