name: ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œ ìë™ ì¬ì‹œë„ # ì´ ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„ì…ë‹ˆë‹¤.

on:
  workflow_run:
    # ì´ ì›Œí¬í”Œë¡œìš°ê°€ ëª¨ë‹ˆí„°ë§í•  ì›Œí¬í”Œë¡œìš°ë“¤ì˜ ëª©ë¡ì…ë‹ˆë‹¤.
    # ì—¬ê¸°ì— ë‚˜ì—´ëœ ì›Œí¬í”Œë¡œìš° ì¤‘ í•˜ë‚˜ë¼ë„ ì™„ë£Œë˜ë©´ ì´ ì›Œí¬í”Œë¡œìš°ê°€ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.
    # GitHub Actions UIì— í‘œì‹œë˜ëŠ” ì •í™•í•œ ì›Œí¬í”Œë¡œìš° 'ì´ë¦„'ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    workflows:
      - GitHub ë¦´ë¦¬ìŠ¤ ìƒì„± # .github/workflows/release1.yml
      - ìë™ ê¸ˆìœµ ë°±ì—…(ìˆ˜ë™ + Cron) # .github/workflows/auto-backup.yml
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸ # .github/workflows/workflow-health-monitor.yml
      - ğŸ”„ PostgreSQL ë° Kafkaë¥¼ ì‚¬ìš©í•œ Finance Smart Backup # .github/workflows/bankbackup.yml
      - ì»¤ë®¤ë‹ˆí‹° ì»¤ë®¤ë‹ˆí‹° ì¬ì‹œë„ # .github/workflows/gitlab-integration.yml
      - ğŸŒ€ ë ˆì§€ë˜íŠ¸ ë°°ì¹˜ ë¡œê·¸ ë°±ì—… # .github/workflows/log-backup-container.yml
      - ìë™ YAML ì›Œí¬í”Œë¡œ ìˆ˜ì • ë° ì¬ì‹¤í–‰ # .github/workflows/delete_workflows.yml
      - ğŸ”„ OTP ì—†ì´ë„ ê¸ˆìœµ ìŠ¤ë§ˆíŠ¸ ë°±ì—… # .github/workflows/finance-smart-backup.yml
      - Codespace ë³´ì•ˆ ì„¤ì • í™•ì¸ # .github/workflows/codespace-security1-check.yml
      - Codespace ë³´ì•ˆ ì„¤ì • í™•ì¸ # .github/workflows/codespace-security-check.yml
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸ # .github/workflows/update_readme.yml
      - Echo()ë¥¼ í†µí•œ OpenAI API ì‚¬ìš© ë¡œê¹…ì„ ì‚¬ìš©í•œ CI # .github/workflows/tokencheck.yml
      - ğŸ” í”ŒëŸ¬ê·¸ì¸/ë³µí˜¸í™” + Codex ê°€ê²© ì¶”ì  # .github/workflows/encrypt-decrypt-tag-label.yml
      - ìë™ ê¸ˆìœµ ë°±ì—… (Manual + Cron) # .github/workflows/auto-backup2.yml
      - ğŸ³ Docker ë¹Œë“œ ë° Echoë¡œ ì‹¤í–‰ # .github/workflows/test.yml
      - í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œ ë°±ì—… # .github/workflows/backup.yml
      - í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œ ë°±ì—… # .github/workflows/build_and_test.yml
      - ğŸ’³ ì¹´ë“œì‚¬ë³„ ê±°ë˜ ë°±ì—… + NetBackup + OCI ì—…ë¡œë“œ # .github/workflows/swift-backup.yml
      - ì›Œí¬í”Œë¡œ ì‹¤í–‰ ë¡œê·¸ ìƒì„± # .github/workflows/generate-workflow-log06.yml
      - â™¾ï¸ ë¬´í•œ ì „ì†¡ ë¡œê·¸ ë°±ì—…(ìƒì£¼) # .github/workflows/transfer-log-infinite-backup.yml
      - ğŸ§¾ ê³ ê° ì†ŒìŠ¤ ìƒì„± + ë¼ì´ë¸ŒëŸ¬ë¦¬ + ë³µí˜¸í™” + í”¼ì ìë™í™” (echo ì™„ì „ ì ìš©) # .github/workflows/customer-image-docker.yml
      - ğŸ§¾ ê²°ì œ ìë™í™” - PDF í¬í•¨ # .github/workflows/cash.yml
      # ìê¸° ìì‹ ì€ ì¼ë°˜ì ìœ¼ë¡œ ì¬ì‹œë„ ëª©ë¡ì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.
      # - ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œ ìë™ ì¬ì‹œë„ # .github/workflows/auto-rerun.yml
      - ê¸ˆìœµ ê±°ë˜ êµ¬ì¶• ë° ì‹œë®¬ë ˆì´ì…˜ # .github/workflows/finance-docker.yml
      - â™¾ï¸ ì „ì†¡ ë¡œê·¸ ë°±ì—… - ë¬´í•œ ìƒì£¼ ì»¨í…Œì´ë„ˆ # .github/workflows/transfer-log-backup1.yml
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸ # .github/workflows/update_readme1.yml
      - ì „ì²´ README.md ìƒì„± # .github/workflows/generate_full_readme.yml
      - ğŸ§± Maven Build(echo ë²„ì „) # .github/workflows/auto-transactions.yml
      - MySQL ìµœì‹  ë²„ì „ ì—…ê·¸ë ˆì´ë“œ # .github/workflows/mysql-upgrade.yml
      - í‚¤ ê°€ê°€ì´ë“œ - PDF í¬í•¨ # .github/workflows/billing.yml
      - ğŸ¦¾ ê±°ë˜ ê´€ë ¨ - PDF í¬í•¨ # .github/workflows/ledger-generator.yml
      - ë³´ì•ˆ ZIP ë° ì¡°ê±´ë¶€ OCI ì—…ë¡œë“œë¥¼ í†µí•´ ê¸°ì—… ì€í–‰ ë°ì´í„° ìƒì„± ë° ë°±ì—… # .github/workflows/docker-ci-cd.yml
      - ğŸ¬ MySQL ì„¤ì •, ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ë°±ì—… # .github/workflows/mysql-integrated.yml
      - ì»¤ë®¤ë‹ˆí‹° ì»¤ë®¤ë‹ˆí‹° ì¬ì‹œë„ # .github/workflows/db.yml
      - ğŸ” ê¸ˆìœµê±°ë˜ ìë™ ë°±ì—… # .github/workflows/docker-finance-build.yml
      - ğŸ³ GHCR + Kafka ìŠ¤íƒ€ì¼ ë¡œê¹…ì„ ì‚¬ìš©í•œ Docker Finance ë°±ì—… # .github/workflows/docker-backup-workflow.yml
      - ğŸ§¾ ê¸ˆìœµ ê±°ë˜ í¬í•¨(PDF í¬í•¨) # .github/workflows/retrigger-and-db-init.yml
      - ğŸ“¦ GitHub ë¦´ë¦¬ìŠ¤ ë§Œë“¤ê¸° # .github/workflows/release.yml
      - GitHub ë¦´ë¦¬ìŠ¤ ìƒì„± # .github/workflows/Release.yml
      - ğŸ’¸ ì „ì†¡ ë¡œê·¸ ë°±ì—…(ë ˆì§€ë˜íŠ¸ ë°°ì¹˜) â€‹â€‹# .github/workflows/transfer-log-backup.yml
      - ğŸ§¾ ë‹¤ì¤‘ íŠ¸ëœì­ì…˜ ë°±ì—…(ì»¨í…Œì´ë„ˆ ìœ í˜•ë³„) # .github/workflows/finance-backup-multi.yml
      - ğŸ¬ ë™ì  í¬íŠ¸ ë° ì˜êµ¬ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•œ MySQL ë°±ì—… # .github/workflows/sql-backup-and-migrate.yml
      - ğŸ” ìë™ ê¸ˆìœµ ë°±ì—…(ìˆ˜ë™ íŠ¸ë¦¬ê±° ì—†ìŒ) # .github/workflows/label.yml
      - ğŸ¬ MySQL ì„¤ì • ë° ë§ˆì´ê·¸ë ˆì´ì…˜ # .github/workflows/mysql-setup.yml
    types:
      - completed # ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ (ì„±ê³µ, ì‹¤íŒ¨, ì·¨ì†Œ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´) ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.

jobs:
  rerun-failed:
    # ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì´ 'failure' (ì‹¤íŒ¨) ë˜ëŠ” 'cancelled' (ì·¨ì†Œ) ìƒíƒœì¼ ë•Œë§Œ ì´ ì‘ì—…ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
    if: ${{ github.event.workflow_run.conclusion == 'failure' || github.event.workflow_run.conclusion == 'cancelled' }}
    runs-on: ubuntu-latest # ì´ ì‘ì—…ì´ ì‹¤í–‰ë  ê°€ìƒ í™˜ê²½ì„ ì§€ì •í•©ë‹ˆë‹¤.

    steps:
      - name: ì›Œí¬í”Œë¡œì— ëŒ€í•´ ì‹¤íŒ¨í•œ ì‘ì—…ì„ ë‹¤ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.
        uses: actions/github-script@v7 # GitHub APIì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•œ ê³µì‹ ì•¡ì…˜ì…ë‹ˆë‹¤.
        with:
          script: |
            // ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•œ ì›ë³¸ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì˜ IDë¥¼ í™˜ê²½ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const runId = process.env.RUN_ID;
            
            // GitHub REST APIë¥¼ í˜¸ì¶œí•˜ì—¬ í•´ë‹¹ run_idì˜ ì‹¤íŒ¨í•œ ëª¨ë“  ì‘ì—…ì„ ì¬ì‹¤í–‰í•©ë‹ˆë‹¤.
            // context.repo.ownerì™€ context.repo.repoëŠ” í˜„ì¬ ë¦¬í¬ì§€í† ë¦¬ì˜ ì†Œìœ ìì™€ ì´ë¦„ì„ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            await github.rest.actions.reRunWorkflowFailedJobs({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: runId
            });
        env:
          # `github.event.workflow_run.id`ëŠ” ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì˜ ê³ ìœ  IDì…ë‹ˆë‹¤.
          # ì´ IDë¥¼ RUN_ID í™˜ê²½ ë³€ìˆ˜ì— í• ë‹¹í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í™œìš©í•©ë‹ˆë‹¤.
          RUN_ID: ${{ github.event.workflow_run.id }}
