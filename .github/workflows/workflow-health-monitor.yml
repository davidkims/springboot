name: Update README

on:
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1) 코드 체크아웃 (풀 히스토리)
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      # 2) Git 사용자 정보 설정
      - name: Configure Git user
        run: |
          echo "Configuring Git user..."
          git config user.name "github-actions[bot]"
          git config user.email "actions@github.com"

      # 3) README.md 변경사항 커밋
      - name: Commit changes to README.md
        run: |
          echo "Adding README.md..."
          git add README.md

          echo "Committing changes..."
          git commit -m "Docs: Update README with analysis and blog info" || {
            echo "No changes to commit. Exiting job."
            exit 0
          }

      # 4) 원격 최신 내용 가져와서 rebase, 실패 시 merge
      - name: Sync with remote
        run: |
          echo "Fetching origin/main..."
          git fetch origin main

          echo "Attempting rebase --autostash..."
          if git pull --rebase --autostash origin main; then
            echo "Rebase successful."
          else
            echo "Rebase failed; falling back to a normal merge..."
            git pull --no-rebase origin main
          fi

      # 5) 변경사항 푸시
      - name: Push to main
        run: |
          echo "Pushing changes to origin/main..."
          git push origin HEAD:main
