name: ğŸ’³ Finance Auto-Ledger with MySQL

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  finance-ledger-job:
    runs-on: ubuntu-latest

    env:
      MYSQL_ROOT_PASS: rootpass123
      DB_NAME: ledger_db

    steps:
      - name: ğŸ”§ MySQL ì„¤ì¹˜
        run: |
          sudo apt-get update
          sudo apt-get install -y mysql-server

      - name: ğŸš€ MySQL ì‹œì‘ ë° ë¶€íŒ… ì‹œ ìë™ ì‹¤í–‰ ì„¤ì •
        run: |
          sudo systemctl start mysql
          sudo systemctl enable mysql

      - name: ğŸ” root ê³„ì • íŒ¨ìŠ¤ì›Œë“œ ì„¤ì • (mysql_native_password)
        run: |
          sudo mysql <<EOF
          ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASS}';
          FLUSH PRIVILEGES;
          EOF

      - name: ğŸ§± Ledger DB ë° ê±°ë˜ í…Œì´ë¸” ìƒì„± + ì´ˆê¸° ë°ì´í„° ì…ë ¥
        run: |
          mysql -u root -p${MYSQL_ROOT_PASS} -e "
            CREATE DATABASE IF NOT EXISTS ${DB_NAME};
            USE ${DB_NAME};
            CREATE TABLE IF NOT EXISTS ledger (
              id INT AUTO_INCREMENT PRIMARY KEY,
              transaction_type VARCHAR(30),
              amount DECIMAL(12,2),
              currency VARCHAR(10),
              status VARCHAR(20),
              detail TEXT,
              created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
            INSERT INTO ledger(transaction_type, amount, currency, status, detail) VALUES
              ('credit_card', 153000, 'KRW', 'completed', 'ì‹ ìš©ì¹´ë“œ ê²°ì œ'),
              ('check_card', 82000, 'KRW', 'completed', 'ì²´í¬ì¹´ë“œ ê²°ì œ'),
              ('stock', 1200000, 'KRW', 'executed', 'ì£¼ì‹ ë§¤ìˆ˜'),
              ('forex', 3000, 'USD', 'completed', 'í™˜ì „ ì²˜ë¦¬'),
              ('bank_transfer', 500000, 'KRW', 'completed', 'ìë™ ì´ì²´ ì™„ë£Œ');
          "

      - name: ğŸ“‹ ê±°ë˜ ì›ì¥ í™•ì¸
        run: |
          mysql -u root -p${MYSQL_ROOT_PASS} -e "USE ${DB_NAME}; SELECT * FROM ledger;"
