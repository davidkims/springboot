name: ðŸ§± Maven Build & Export

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      MAVEN_VERSION: 3.9.6
      MAVEN_HOME: /opt/maven
      EXPORT_DIR: /opt/export
      BUILD_DIR: build-artifacts

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Install Maven
        run: |
          MAVEN_URL="https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz"
          wget -q "$MAVEN_URL" -O maven.tar.gz
          sudo tar xzf maven.tar.gz -C /opt
          sudo mv "/opt/apache-maven-${MAVEN_VERSION}" "$MAVEN_HOME"
          echo "$MAVEN_HOME/bin" >> $GITHUB_PATH

      - name: ðŸ§¾ Create pom.xml if missing
        run: |
          if [ ! -f pom.xml ]; then
            echo "ðŸ“„ pom.xml ìžë™ ìƒì„±"
            tee pom.xml > /dev/null <<'EOF'
          fi

      - name: ðŸ”¨ Build with Maven
        run: |
          echo "âš™ï¸ ë¹Œë“œ ì‹œìž‘"
          mvn clean install -B

      - name: ðŸ“‚ Prepare export directories
        run: |
          mkdir -p "$EXPORT_DIR"
          mkdir -p "$BUILD_DIR"

      - name: ðŸ“¦ Export JARs
        run: |
          find . -type f -name "*.jar" -path "*/target/*.jar" -exec cp {} "$EXPORT_DIR/" \;
          cp "$EXPORT_DIR"/*.jar "$BUILD_DIR/" || echo "âŒ JAR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"

      - name: âœ… ì™„ë£Œ
        run: echo "ðŸŽ‰ JAR ë¹Œë“œ ë° ë‚´ë³´ë‚´ê¸° ìž‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
