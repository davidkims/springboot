## ì „ì²´ ì›Œí¬í”Œë¡œìš° ì½”ë“œ
# íŒŒì¼ëª…: .github/workflows/release.yml
# ì„¤ëª…: ì´ ì›Œí¬í”Œë¡œìš°ëŠ” 'v'ë¡œ ì‹œì‘í•˜ëŠ” ìƒˆ íƒœê·¸(ì˜ˆ: v1.0.0)ê°€ ë¦¬í¬ì§€í† ë¦¬ì— í‘¸ì‹œë  ë•Œë§ˆë‹¤
#        Swift CLI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  GitHub Releaseë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

name: Create GitHub Release

on:
  push:
    tags:
      - 'v*' # 'v1.0.0', 'v1.0.1-beta' ë“± 'v'ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  íƒœê·¸ì— ì˜í•´ íŠ¸ë¦¬ê±°

jobs:
  release:
    runs-on: ubuntu-latest # macOS ë°”ì´ë„ˆë¦¬ê°€ í•„ìš”í•œ ê²½ìš° 'macos-latest'ë¡œ ë³€ê²½

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4 # ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

    - name: Install Swift Toolchain
      # ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš°ì™€ ë™ì¼í•œ Swift ë²„ì „ ì‚¬ìš© ê¶Œì¥
      uses: swift-actions/setup-swift@v2
      with:
        swift-version: '5.10'

    - name: Get Project Name
      id: get_project_name
      run: |
        # ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„ì´ Swift ì‹¤í–‰ íŒŒì¼ì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
        # í•„ìš”í•˜ë‹¤ë©´ Package.swift íŒŒì¼ì—ì„œ ì‹¤ì œ ì‹¤í–‰ íŒŒì¼ ì´ë¦„ì„ íŒŒì‹±í•˜ë„ë¡ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        PROJECT_NAME=$(basename ${{ github.repository }})
        echo "project_name=$PROJECT_NAME" >> $GITHUB_OUTPUT

    - name: Build Release Executable
      # Package.swift íŒŒì¼ì´ ë¦¬í¬ì§€í† ë¦¬ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
      run: swift build -c release

    - name: Prepare Release Assets
      id: prepare_assets
      run: |
        EXECUTABLE_NAME=${{ steps.get_project_name.outputs.project_name }}
        TAG_NAME=${{ github.ref_name }} # ì˜ˆ: v1.0.0
        RUNNER_OS_LOWER=$(echo "${{ runner.os }}" | tr '[:upper:]' '[:lower:]') # ìš´ì˜ì²´ì œ ì´ë¦„ì„ ì†Œë¬¸ìë¡œ ë³€í™˜
        ARCHIVE_NAME="${EXECUTABLE_NAME}-${TAG_NAME}-${RUNNER_OS_LOWER}.zip"
        RELEASE_DIR="release_assets"

        mkdir -p "${RELEASE_DIR}"

        # ì»´íŒŒì¼ëœ ì‹¤í–‰ íŒŒì¼ ë³µì‚¬
        cp ".build/release/${EXECUTABLE_NAME}" "${RELEASE_DIR}/${EXECUTABLE_NAME}"

        # ì‹¤í–‰ íŒŒì¼ì„ ì••ì¶• (zip)í•˜ì—¬ ë¦´ë¦¬ì¦ˆ ìì‚°ìœ¼ë¡œ ì¤€ë¹„
        cd "${RELEASE_DIR}"
        zip -r "../${ARCHIVE_NAME}" "${EXECUTABLE_NAME}"
        cd - # ì›ë˜ ë””ë ‰í† ë¦¬ë¡œ ëŒì•„ê°€ê¸°
        echo "archive_path=${ARCHIVE_NAME}" >> $GITHUB_OUTPUT

    - name: Get Release Notes (Optional)
      id: get_release_notes
      run: |
        # ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        echo "release_body=ğŸš€ New Release: ${{ github.ref_name }}" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v2 # GitHub ë¦´ë¦¬ì¦ˆë¥¼ ìƒì„±í•˜ëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤.
      with:
        tag_name: ${{ github.ref }} # ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•œ íƒœê·¸ (ì˜ˆ: refs/tags/v1.0.0)
        name: Release ${{ github.ref_name }} # GitHub ë¦´ë¦¬ì¦ˆì— í‘œì‹œë  ì´ë¦„ (ì˜ˆ: v1.0.0)
        body: ${{ steps.get_release_notes.outputs.release_body }} # ë¦´ë¦¬ì¦ˆ ë³¸ë¬¸ ë‚´ìš©
        files: |
          ${{ steps.prepare_assets.outputs.archive_path }} # ì¤€ë¹„ëœ ì••ì¶• íŒŒì¼ ì²¨ë¶€
          # ë‹¤ë¥¸ ì²¨ë¶€í•  íŒŒì¼ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€ (ì˜ˆ: "path/to/my-doc.pdf")
        draft: false # ì´ˆì•ˆìœ¼ë¡œ ë¦´ë¦¬ì¦ˆë¥¼ ìƒì„±í•˜ë ¤ë©´ trueë¡œ ë³€ê²½
        prerelease: false # ì‚¬ì „ ë¦´ë¦¬ì¦ˆ(ë² íƒ€ ë“±)ì¸ ê²½ìš° trueë¡œ ë³€ê²½
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GitHubì—ì„œ ìë™ìœ¼ë¡œ ì œê³µí•˜ëŠ” í† í° (ì“°ê¸° ê¶Œí•œ í•„ìš”)
