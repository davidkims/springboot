name: ğŸ” MySQL Ledger Setup & Transaction Logging

on:
  workflow_dispatch:
  schedule:
    - cron: '*/10 * * * *'  # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰

jobs:
  mysql-ledger-job:
    runs-on: ubuntu-latest

    env:
      MYSQL_ROOT_PASS: rootpass123
      DB_NAME: ledger_db

    steps:
      - name: ğŸ“¦ Install MySQL Server
        run: |
          sudo apt-get update
          sudo apt-get install -y mysql-server

      - name: ğŸš€ Start MySQL Service
        run: |
          sudo systemctl start mysql
          sudo systemctl enable mysql
          sudo systemctl status mysql

      - name: ğŸ” Set Root Password
        run: |
          sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASS}'; FLUSH PRIVILEGES;"

      - name: ğŸ§± Create Ledger DB and Tables
        run: |
          sudo mysql -u root -p${MYSQL_ROOT_PASS} -e "
            CREATE DATABASE IF NOT EXISTS ${DB_NAME};
            USE ${DB_NAME};
            CREATE TABLE IF NOT EXISTS ledger (
              id INT AUTO_INCREMENT PRIMARY KEY,
              transaction_type VARCHAR(30),
              amount DECIMAL(12, 2),
              currency VARCHAR(10),
              status VARCHAR(20),
              detail TEXT,
              created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
            INSERT INTO ledger(transaction_type, amount, currency, status, detail) VALUES
              ('credit_card', 153000.00, 'KRW', 'completed', 'ì‹ ìš©ì¹´ë“œ ê²°ì œ ì™„ë£Œ'),
              ('check_card', 82000.00, 'KRW', 'completed', 'ì²´í¬ì¹´ë“œ ê²°ì œ ì™„ë£Œ'),
              ('stock', 1200000.00, 'KRW', 'executed', 'ì‚¼ì„±ì „ì ì£¼ì‹ ë§¤ìˆ˜'),
              ('forex', 3000.00, 'USD', 'completed', 'KRW/USD í™˜ì „ ê±°ë˜ ì™„ë£Œ');
          "

      - name: ğŸ“„ View Ledger Table
        run: |
          sudo mysql -u root -p${MYSQL_ROOT_PASS} -e "USE ${DB_NAME}; SELECT * FROM ledger;"
