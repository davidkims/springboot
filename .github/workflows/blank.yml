name: ğŸ“˜ READMEì— ì›Œí¬í”Œë¡œìš° ìë™ ìš”ì•½ (echo ê¸°ë°˜)

on:
  push:
    paths:
      - ".github/workflows/*.yml"
  workflow_dispatch:

jobs:
  summarize-workflows:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Python ì„¤ì¹˜ ë° ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (echo ê¸°ë°˜)
      run: |
        pip install pyyaml

        echo "import os, yaml

workflow_dir = '.github/workflows'
rows = []

for file in os.listdir(workflow_dir):
    if file.endswith('.yml') or file.endswith('.yaml'):
        path = os.path.join(workflow_dir, file)
        with open(path, encoding='utf-8') as f:
            try:
                data = yaml.safe_load(f)
                name = data.get('name', 'N/A')
                trigger = ', '.join(data.get('on', {}).keys()) if isinstance(data.get('on'), dict) else str(data.get('on'))
                jobs = ', '.join(data.get('jobs', {}).keys()) if 'jobs' in data else 'N/A'
                rows.append((file, name, trigger, jobs))
            except Exception as e:
                rows.append((file, 'âš ï¸ ì˜¤ë¥˜', 'N/A', 'N/A'))

table = '| ì›Œí¬í”Œë¡œìš° íŒŒì¼ | ì›Œí¬í”Œë¡œìš° ì´ë¦„ | íŠ¸ë¦¬ê±° | ì£¼ìš” ì‘ì—… |\\n'
table += '|----------------|----------------|--------|-----------|\\n'
for r in rows:
    table += f'| {r[0]} | {r[1]} | {r[2]} | {r[3]} |\\n'

readme_path = 'README.md'
if not os.path.exists(readme_path):
    with open(readme_path, 'w', encoding='utf-8') as f:
        f.write('# í”„ë¡œì íŠ¸ ì„¤ëª…\\n\\n')

with open(readme_path, 'r', encoding='utf-8') as rf:
    original = rf.read()

if '## ğŸ”§ GitHub Actions ì›Œí¬í”Œë¡œìš° ìš”ì•½' in original:
    head = original.split('## ğŸ”§ GitHub Actions ì›Œí¬í”Œë¡œìš° ìš”ì•½')[0].strip()
else:
    head = original.strip()

with open(readme_path, 'w', encoding='utf-8') as wf:
    wf.write(head + '\\n\\n## ğŸ”§ GitHub Actions ì›Œí¬í”Œë¡œìš° ìš”ì•½\\n\\n' + table)

print('âœ… README.md ì—…ë°ì´íŠ¸ ì™„ë£Œ')
" > summarize_workflows.py

        python3 summarize_workflows.py

    - name: âœ… ë³€ê²½ ì»¤ë°‹ ë° í‘¸ì‹œ
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add README.md
        git commit -m "ğŸ“˜ README ì›Œí¬í”Œë¡œìš° ìš”ì•½ ìë™ ì—…ë°ì´íŠ¸" || echo "ë³€ê²½ ì‚¬í•­ ì—†ìŒ"
        git push
