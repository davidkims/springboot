name: ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œ ìë™ ì¬ì‹œë„

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1) ê¶Œí•œ ì„¤ì •
permissions:
  contents: read         # (í•„ìš”ì— ë”°ë¼ ìˆ˜ì •)
  actions: write         # reRunWorkflowFailedJobs API í˜¸ì¶œì„ ìœ„í•´ í•„ìˆ˜

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  workflow_run:
    # UIì— í‘œì‹œë˜ëŠ” 'ì›Œí¬í”Œë¡œìš° ì´ë¦„'ì„ ì •í™•íˆ ë‚˜ì—´í•´ì•¼ í•©ë‹ˆë‹¤.
    workflows:
      - GitHub ë¦´ë¦¬ìŠ¤ ìƒì„±                        # .github/workflows/release1.yml ì˜ name: â€œGitHub ë¦´ë¦¬ìŠ¤ ìƒì„±â€
      - ìë™ ê¸ˆìœµ ë°±ì—…(ìˆ˜ë™ + Cron)                # .github/workflows/auto-backup.yml ì˜ name: â€œìë™ ê¸ˆìœµ ë°±ì—…(ìˆ˜ë™ + Cron)â€
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸               # .github/workflows/workflow-health-monitor.yml ì˜ name ê°’
      - ğŸ”„ PostgreSQL ë° Kafkaë¥¼ ì‚¬ìš©í•œ Finance Smart Backup  # .github/workflows/bankbackup.yml ì˜ name ê°’
      - ì»¤ë®¤ë‹ˆí‹° ì»¤ë®¤ë‹ˆí‹° ì¬ì‹œë„                    # .github/workflows/gitlab-integration.yml ì˜ name ê°’
      - ğŸŒ€ ë ˆì§€ë˜íŠ¸ ë°°ì¹˜ ë¡œê·¸ ë°±ì—…                  # .github/workflows/log-backup-container.yml ì˜ name ê°’
      - ìë™ YAML ì›Œí¬í”Œë¡œ ìˆ˜ì • ë° ì¬ì‹¤í–‰           # .github/workflows/delete_workflows.yml ì˜ name ê°’
      - ğŸ”„ OTP ì—†ì´ë„ ê¸ˆìœµ ìŠ¤ë§ˆíŠ¸ ë°±ì—…               # .github/workflows/finance-smart-backup.yml ì˜ name ê°’
      - Codespace ë³´ì•ˆ ì„¤ì • í™•ì¸                  # .github/workflows/codespace-security1-check.yml ì˜ name ê°’
      - Codespace ë³´ì•ˆ ì„¤ì • í™•ì¸                  # .github/workflows/codespace-security-check.yml ì˜ name ê°’
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸               # .github/workflows/update_readme.yml ì˜ name ê°’
      - Echo()ë¥¼ í†µí•œ OpenAI API ì‚¬ìš© ë¡œê¹…ì„ ì‚¬ìš©í•œ CI  # .github/workflows/tokencheck.yml ì˜ name ê°’
      - ğŸ” í”ŒëŸ¬ê·¸ì¸/ë³µí˜¸í™” + Codex ê°€ê²© ì¶”ì          # .github/workflows/encrypt-decrypt-tag-label.yml ì˜ name ê°’
      - ìë™ ê¸ˆìœµ ë°±ì—… (Manual + Cron)             # .github/workflows/auto-backup2.yml ì˜ name ê°’
      - ğŸ³ Docker ë¹Œë“œ ë° Echoë¡œ ì‹¤í–‰              # .github/workflows/test.yml ì˜ name ê°’
      - í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œ ë°±ì—…                     # .github/workflows/backup.yml ì˜ name ê°’
      - í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œ ë°±ì—…                     # .github/workflows/build_and_test.yml ì˜ name ê°’
      - ğŸ’³ ì¹´ë“œì‚¬ë³„ ê±°ë˜ ë°±ì—… + NetBackup + OCI ì—…ë¡œë“œ  # .github/workflows/swift-backup.yml ì˜ name ê°’
      - ì›Œí¬í”Œë¡œ ì‹¤í–‰ ë¡œê·¸ ìƒì„±                   # .github/workflows/generate-workflow-log06.yml ì˜ name ê°’
      - â™¾ï¸ ë¬´í•œ ì „ì†¡ ë¡œê·¸ ë°±ì—…(ìƒì£¼)               # .github/workflows/transfer-log-infinite-backup.yml ì˜ name ê°’
      - ğŸ§¾ ê³ ê° ì†ŒìŠ¤ ìƒì„± + ë¼ì´ë¸ŒëŸ¬ë¦¬ + ë³µí˜¸í™” + í”¼ì ìë™í™” (echo ì™„ì „ ì ìš©)  # .github/workflows/customer-image-docker.yml ì˜ name ê°’
      - ğŸ§¾ ê²°ì œ ìë™í™” - PDF í¬í•¨                  # .github/workflows/cash.yml ì˜ name ê°’
      # ìê¸° ìì‹ ì€ ì¬ì‹œë„ ëŒ€ìƒì—ì„œ ì œì™¸
      # - ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œ ìë™ ì¬ì‹œë„               # .github/workflows/auto-rerun.yml ì˜ name ê°’
      - ê¸ˆìœµ ê±°ë˜ êµ¬ì¶• ë° ì‹œë®¬ë ˆì´ì…˜                # .github/workflows/finance-docker.yml ì˜ name ê°’
      - â™¾ï¸ ì „ì†¡ ë¡œê·¸ ë°±ì—… - ë¬´í•œ ìƒì£¼ ì»¨í…Œì´ë„ˆ          # .github/workflows/transfer-log-backup1.yml ì˜ name ê°’
      - Repo ë¶„ì„ ë° README ì—…ë°ì´íŠ¸               # .github/workflows/update_readme1.yml ì˜ name ê°’
      - ì „ì²´ README.md ìƒì„±                         # .github/workflows/generate_full_readme.yml ì˜ name ê°’
      - ğŸ§± Maven Build(echo ë²„ì „)                  # .github/workflows/auto-transactions.yml ì˜ name ê°’
      - MySQL ìµœì‹  ë²„ì „ ì—…ê·¸ë ˆì´ë“œ                  # .github/workflows/mysql-upgrade.yml ì˜ name ê°’
      - í‚¤ ê°€ê°€ì´ë“œ - PDF í¬í•¨                      # .github/workflows/billing.yml ì˜ name ê°’
      - ğŸ¦¾ ê±°ë˜ ê´€ë ¨ - PDF í¬í•¨                     # .github/workflows/ledger-generator.yml ì˜ name ê°’
      - ë³´ì•ˆ ZIP ë° ì¡°ê±´ë¶€ OCI ì—…ë¡œë“œë¥¼ í†µí•´ ê¸°ì—… ì€í–‰ ë°ì´í„° ìƒì„± ë° ë°±ì—…  # .github/workflows/docker-ci-cd.yml ì˜ name ê°’
      - ğŸ¬ MySQL ì„¤ì •, ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ë°±ì—…          # .github/workflows/mysql-integrated.yml ì˜ name ê°’
      - ì»¤ë®¤ë‹ˆí‹° ì»¤ë®¤ë‹ˆí‹° ì¬ì‹œë„                    # .github/workflows/db.yml ì˜ name ê°’
      - ğŸ” ê¸ˆìœµê±°ë˜ ìë™ ë°±ì—…                       # .github/workflows/docker-finance-build.yml ì˜ name ê°’
      - ğŸ³ GHCR + Kafka ìŠ¤íƒ€ì¼ ë¡œê¹…ì„ ì‚¬ìš©í•œ Docker Finance ë°±ì—…   # .github/workflows/docker-backup-workflow.yml ì˜ name ê°’
      - ğŸ§¾ ê¸ˆìœµ ê±°ë˜ í¬í•¨(PDF í¬í•¨)                  # .github/workflows/retrigger-and-db-init.yml ì˜ name ê°’
      - ğŸ“¦ GitHub ë¦´ë¦¬ìŠ¤ ë§Œë“¤ê¸°                     # .github/workflows/release.yml ì˜ name ê°’
      - GitHub ë¦´ë¦¬ìŠ¤ ìƒì„±                          # .github/workflows/Release.yml ì˜ name ê°’
      - ğŸ’¸ ì „ì†¡ ë¡œê·¸ ë°±ì—…(ë ˆì§€ë˜íŠ¸ ë°°ì¹˜)              # .github/workflows/transfer-log-backup.yml ì˜ name ê°’
      - ğŸ§¾ ë‹¤ì¤‘ íŠ¸ëœì­ì…˜ ë°±ì—…(ì»¨í…Œì´ë„ˆ ìœ í˜•ë³„)           # .github/workflows/finance-backup-multi.yml ì˜ name ê°’
      - ğŸ¬ ë™ì  í¬íŠ¸ ë° ì˜êµ¬ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•œ MySQL ë°±ì—… # .github/workflows/sql-backup-and-migrate.yml ì˜ name ê°’
      - ğŸ” ìë™ ê¸ˆìœµ ë°±ì—…(ìˆ˜ë™ íŠ¸ë¦¬ê±° ì—†ìŒ)             # .github/workflows/label.yml ì˜ name ê°’
      - ğŸ¬ MySQL ì„¤ì • ë° ë§ˆì´ê·¸ë ˆì´ì…˜                  # .github/workflows/mysql-setup.yml ì˜ name ê°’
    types:
      - completed  # ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë  ë•Œ (ì„±ê³µ/ì‹¤íŒ¨/ì·¨ì†Œ êµ¬ë¶„ ì—†ì´ íŠ¸ë¦¬ê±°)

jobs:
  rerun-failed:
    # ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì´ ì‹¤íŒ¨(failure) ë˜ëŠ” ì·¨ì†Œ(cancelled)ì¼ ë•Œë§Œ ì‹¤í–‰
    if: ${{ github.event.workflow_run.conclusion == 'failure' || github.event.workflow_run.conclusion == 'cancelled' }}
    runs-on: ubuntu-latest

    steps:
      - name: â€œFAIL-RETRYâ€ â€” ì‹¤íŒ¨í•œ ì‘ì—… ìë™ ì¬ì‹¤í–‰
        uses: actions/github-script@v7
        with:
          script: |
            // ì¬ì‹¤í–‰í•  ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ IDë¥¼ í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì–»ìŒ
            const runId = process.env.RUN_ID;
            if (!runId) {
              core.setFailed('RUN_ID í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
              return;
            }

            // í•´ë‹¹ run_idì— ì†í•œ ì‹¤íŒ¨(failed)/ì·¨ì†Œ(cancelled)ëœ jobë“¤ë§Œ ì¬ì‹¤í–‰
            await github.rest.actions.reRunWorkflowFailedJobs({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: runId
            });
        env:
          RUN_ID: ${{ github.event.workflow_run.id }}
