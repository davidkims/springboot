name: Scorecard Supply-Chain Security

on:
 echo "branch_protection_rules:"
  schedule:
    - cron: '21 2 * * 0' # ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 2ì‹œ 21ë¶„ UTCì— ì‹¤í–‰
  push:
    branches: ["main"]

permissions:
  contents: read

jobs:
  analyze:
    name: Scorecard ë¶„ì„
    runs-on: ubuntu-latest
    if: github.event.repository.default_branch == github.ref_name || github.event_name == 'pull_request'
    permissions:
      security-events: write
      id-token: write
      contents: read

    steps:
      - name: ">> ìŠ¤í… ì‹œì‘: ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ"
        run: echo "--- ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ ìŠ¤í… ì‹œì‘ ---"
      - name: "ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ"
        uses: actions/checkout@v4 # ìµœì‹  ì•ˆì •í™” ë²„ì „ íƒœê·¸ ì‚¬ìš©
      - name: "<< ìŠ¤í… ì™„ë£Œ: ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ"
        run: echo "--- ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ ìŠ¤í… ì™„ë£Œ ---"

      - name: ">> ìŠ¤í… ì‹œì‘: OpenSSF Scorecard ë¶„ì„ ì‹¤í–‰"
        run: echo "--- Scorecard ë¶„ì„ ìŠ¤í… ì‹œì‘ ---"
      - name: "OpenSSF Scorecard ë¶„ì„ ì‹¤í–‰"
        # --- ğŸ”´ ì´ ë¶€ë¶„ì„ ì•„ë˜ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¡œ ìˆ˜ì •í•˜ì„¸ìš” ğŸ”´ ---
        # ì˜µì…˜ 1 (ê¶Œì¥): ìµœì‹  ì»¤ë°‹ SHA ì‚¬ìš© (ossf/scorecard-action GitHub ì €ì¥ì†Œì—ì„œ í™•ì¸)
        uses: ossf/scorecard-action@1a415a775193984d720b7218684d0b17b01d6706 # 2025ë…„ 6ì›” 8ì¼ ê¸°ì¤€ v2.4.1ì˜ SHA

        # ì˜µì…˜ 2 (ëŒ€ì•ˆ): ìµœì‹  ì•ˆì •í™” ë²„ì „ íƒœê·¸ ì‚¬ìš© (ë§Œì•½ v2ê°€ ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´ v2.4.1 ë“± íŠ¹ì • íƒœê·¸ ì‹œë„)
        # uses: ossf/scorecard-action@v2.4.1 # v2 íƒœê·¸ê°€ ì•ˆëœë‹¤ë©´ êµ¬ì²´ì ì¸ v2.x.x íƒœê·¸ ì‹œë„

        with:
          results_file: results.sarif
          results_format: sarif
          publish_results: true
          # repo_token: ${{ secrets.SCORECARD_TOKEN }} # í•„ìš”í•œ ê²½ìš° ì£¼ì„ í•´ì œ

      - name: "Scorecard ë¶„ì„ ê²°ê³¼ í™•ì¸"
        run: |
          echo "Scorecard ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. results.sarif íŒŒì¼ ë‚´ìš©ì„ í™•ì¸í•©ë‹ˆë‹¤."
          if [ -f "results.sarif" ]; then
            echo "results.sarif íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
            cat results.sarif | head -n 20
          else
            echo "ì˜¤ë¥˜: results.sarif íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            exit 1
          fi
      - name: "<< ìŠ¤í… ì™„ë£Œ: OpenSSF Scorecard ë¶„ì„ ì‹¤í–‰"
        run: echo "--- Scorecard ë¶„ì„ ìŠ¤í… ì™„ë£Œ ---"

      - name: ">> ìŠ¤í… ì‹œì‘: SARIF ê²°ê³¼ë¥¼ ì•„í‹°íŒ©íŠ¸ë¡œ ì—…ë¡œë“œ"
        run: echo "--- ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ ìŠ¤í… ì‹œì‘ ---"
      - name: "SARIF ê²°ê³¼ë¥¼ ì•„í‹°íŒ©íŠ¸ë¡œ ì—…ë¡œë“œ"
        uses: actions/upload-artifact@v4 # ìµœì‹  ì•ˆì •í™” ë²„ì „ íƒœê·¸ ì‚¬ìš©
        with:
          name: Scorecard SARIF íŒŒì¼
          path: results.sarif
          retention-days: 7
      - name: "<< ìŠ¤í… ì™„ë£Œ: SARIF ê²°ê³¼ë¥¼ ì•„í‹°íŒ©íŠ¸ë¡œ ì—…ë¡œë“œ"
        run: echo "--- ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ ìŠ¤í… ì™„ë£Œ ---"

      - name: ">> ìŠ¤í… ì‹œì‘: ê²°ê³¼ë¥¼ GitHub ì½”ë“œ ìŠ¤ìºë‹ ëŒ€ì‹œë³´ë“œì— ì—…ë¡œë“œ"
        run: echo "--- ì½”ë“œ ìŠ¤ìºë‹ ì—…ë¡œë“œ ìŠ¤í… ì‹œì‘ ---"
      - name: "ê²°ê³¼ë¥¼ GitHub ì½”ë“œ ìŠ¤ìºë‹ ëŒ€ì‹œë³´ë“œì— ì—…ë¡œë“œ"
        uses: github/codeql-action/upload-sarif@v3 # ìµœì‹  ì•ˆì •í™” ë²„ì „ íƒœê·¸ ì‚¬ìš©
        with:
          sarif_file: results.sarif
      - name: "<< ìŠ¤í… ì™„ë£Œ: ê²°ê³¼ë¥¼ GitHub ì½”ë“œ ìŠ¤ìºë‹ ëŒ€ì‹œë³´ë“œì— ì—…ë¡œë“œ"
        run: echo "--- ì½”ë“œ ìŠ¤ìºë‹ ì—…ë¡œë“œ ìŠ¤í… ì™„ë£Œ ---"

      - name: ">> ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¢…ë£Œ"
        run: echo "--- ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ ---"
