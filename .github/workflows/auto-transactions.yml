name: ğŸ” Fix MySQL Root Password (2ë‹¨ê³„ ë°©ì‹)

on:
  workflow_dispatch:

jobs:
  mysql-fix:
    runs-on: ubuntu-latest

    env:
      MYSQL_ROOT_PASS: rootpass123

    steps:
      - name: ğŸ“¦ Install MySQL
        run: |
          sudo apt-get update
          sudo apt-get install -y mysql-server

      - name: ğŸš« Enable skip-grant-tables
        run: |
          echo '[mysqld]' | sudo tee /etc/mysql/mysql.conf.d/skip-auth.cnf
          echo 'skip-grant-tables' | sudo tee -a /etc/mysql/mysql.conf.d/skip-auth.cnf
          sudo systemctl restart mysql

      - name: ğŸ› ï¸ Set password manually via system table
        run: |
          sudo mysql -e "
            UPDATE mysql.user
            SET authentication_string=PASSWORD('${MYSQL_ROOT_PASS}'), plugin='mysql_native_password'
            WHERE User='root' AND Host='localhost';
            FLUSH PRIVILEGES;
          "

      - name: ğŸ” Disable skip-grant-tables
        run: |
          sudo rm /etc/mysql/mysql.conf.d/skip-auth.cnf
          sudo systemctl restart mysql

      - name: âœ… Verify login with password
        run: |
          mysql -u root -p${MYSQL_ROOT_PASS} -e "SELECT VERSION();"
