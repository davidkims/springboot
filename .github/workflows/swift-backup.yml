name: ðŸ› ï¸ Swift CLI ì„¤ì¹˜ ë° DB ë°±ì—…

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  swift-backup:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“ ì €ìž¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ðŸ§° Swift CLI ì„¤ì¹˜
        run: |
          sudo apt-get update
          sudo apt-get install -y clang libicu-dev libpython3-dev
          curl -fsSL https://download.swift.org/swift-5.9-release/ubuntu2204/swift-5.9-RELEASE/swift-5.9-RELEASE-ubuntu22.04.tar.gz -o swift.tar.gz
          sudo mkdir -p /opt/swift
          sudo tar -xzf swift.tar.gz -C /opt/swift --strip-components=1
          echo "/opt/swift/usr/bin" >> $GITHUB_PATH
          swift --version

      - name: ðŸ› ï¸ Swift í”„ë¡œê·¸ëž¨ ë¹Œë“œ
        run: |
          mkdir -p swiftapp
          echo 'print("âœ… Swift í”„ë¡œê·¸ëž¨ ì‹¤í–‰")' > swiftapp/main.swift
          /opt/swift/usr/bin/swiftc swiftapp/main.swift -o swiftapp/Program
          chmod +x swiftapp/Program
          ./swiftapp/Program

      - name: ðŸš€ í”„ë¡œê·¸ëž¨ íŒŒì¼ ì„¤ì¹˜
        run: |
          sudo mkdir -p /opt/swiftapp/bin
          sudo cp swiftapp/Program /opt/swiftapp/bin/
          sudo chmod +x /opt/swiftapp/bin/Program

      - name: ðŸ’¾ Swift DB ë°±ì—… (ìƒ˜í”Œ JSON)
        run: |
          sudo mkdir -p /opt/backup/swift
          BACKUP_TIME=$(date -Iseconds)
          echo "{" > /opt/backup/swift/swift-db.json
          echo '  "users": [' >> /opt/backup/swift/swift-db.json
          echo '    { "id": 1, "name": "í™ê¸¸ë™", "email": "hong@example.com" },' >> /opt/backup/swift/swift-db.json
          echo '    { "id": 2, "name": "ê¹€ì² ìˆ˜", "email": "kim@example.com" }' >> /opt/backup/swift/swift-db.json
          echo '  ],' >> /opt/backup/swift/swift-db.json
          echo "  \"backup_time\": \"${BACKUP_TIME}\"" >> /opt/backup/swift/swift-db.json
          echo "}" >> /opt/backup/swift/swift-db.json
          cat /opt/backup/swift/swift-db.json

      - name: ðŸ“ ë°±ì—… ë³´ê³ ì„œ ìƒì„±
        run: |
          echo "# Swift ë°±ì—… ë³´ê³ ì„œ" > swift-backup-report.md
          echo "- ë°±ì—… ì‹œê°„: $(date)" >> swift-backup-report.md
          echo "- í”„ë¡œê·¸ëž¨ ê²½ë¡œ: /opt/swiftapp/bin/Program" >> swift-backup-report.md
          echo "- ë°±ì—… íŒŒì¼: /opt/backup/swift/swift-db.json" >> swift-backup-report.md
