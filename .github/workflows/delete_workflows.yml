name: Auto YAML Workflow Lint & Report

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read

jobs:
  yaml_lint:
    name: "YAML 워크플로우 파일 검사 및 리포트"
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      ####################################################################
      # 1) 전체 히스토리 체크아웃
      ####################################################################
      - name: Checkout repository (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      ####################################################################
      # 2) 필요한 도구 설치: Node.js, Prettier, yamllint
      ####################################################################
      - name: Install Node.js & YAML linter
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          pip3 install yamllint

          # Node.js 설치 (Prettier 실행용)
          curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
          sudo apt-get install -y nodejs
          npm install -g prettier

      ####################################################################
      # 3) Prettier로 YAML workflow 파일 포맷팅 (Dry-run 모드로 포맷 제안만 출력)
      ####################################################################
      - name: Check Prettier formatting suggestions
        run: |
          echo "▶ Prettier가 적용될 수 있는 부분이 있는지 확인 중..."
          # --check 옵션: 실제 수정 없이, “포맷이 필요한 파일”만 보고
          prettier --check ".github/workflows/*.yml" || true

      ####################################################################
      # 4) yamllint으로 YAML workflow 파일 검사
      ####################################################################
      - name: Run yamllint on .github/workflows/*.yml
        run: |
          echo "=========================================="
          echo "▶ yamllint으로 YAML 워크플로우 파일 검사"
          echo "=========================================="
          yamllint -d "{extends: default, rules: {line-length: {max: 80}}}" .github/workflows/*.yml
