---
name: "\U0001F512 Encrypt, Decrypt, Tag & Label"

"on":
  workflow_dispatch:

jobs:
  encrypt-decrypt:
    runs-on: ubuntu-latest
    steps:
      - name: \U0001F4C2 Checkout repository
        uses: actions/checkout@v4

      - name: \U0001F4E6 Create sample file and encrypt/decrypt
        env:
          PASS: ${{ secrets.SECRET_PASS }}
        run: |
          echo "Sensitive transaction data" > secret.txt
          openssl enc -aes-256-cbc -pbkdf2 -salt \
            -in secret.txt -out secret.enc -pass pass:$PASS
          openssl enc -aes-256-cbc -d -pbkdf2 -salt \
            -in secret.enc -out secret.dec.txt -pass pass:$PASS
          diff secret.txt secret.dec.txt

      - name: \U0001F4CB Create tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          VERSION="v$(date +%Y%m%d%H%M%S)"
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"
          git tag -a "$VERSION" -m "Automated tag"
          git push origin "$VERSION"

      - name: \U0001F3F7 Create label
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          JSON='{"name":"encrypted","color":"B60205",'
          JSON+=' "description":"Encryption completed"}'
          curl -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${{ github.repository }}/labels \
            -d "$JSON" || echo "Label already exists"
