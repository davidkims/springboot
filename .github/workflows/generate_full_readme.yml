name: Generate Full README.md

on:
  workflow_dispatch: # GitHub UIì—ì„œ ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  push:
    branches: ["main"] # 'main' ë¸Œëœì¹˜ì— ì½”ë“œê°€ í‘¸ì‹œë  ë•Œ ì‹¤í–‰
    paths-ignore:
      - 'README.md' # README.md ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì›Œí¬í”Œë¡œìš° ë¬´í•œ ë£¨í”„ ë°©ì§€

jobs:
  generate-readme:
    runs-on: ubuntu-latest

    # ì¤‘ìš”: GITHUB_TOKENì— ì“°ê¸° ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.
    # ì´ ê¶Œí•œì´ ì—†ìœ¼ë©´ github-actions[bot]ì´ ë³€ê²½ ì‚¬í•­ì„ í‘¸ì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    permissions:
      contents: write # ì´ ì„¤ì •ì´ git pushë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4
        with:
          # git logë¥¼ ì‚¬ìš©í•˜ê³  push ì‹œ rebaseë¥¼ ìœ„í•´ ì „ì²´ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
          fetch-depth: 0 
          # GITHUB_TOKENì€ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ë©°, ìœ„ permissions ì„¤ì •ìœ¼ë¡œ ì“°ê¸° ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤.
          token: ${{ secrets.GITHUB_TOKEN }} 

      - name: ğŸ Set up Python (Optional:for more complex scripting)
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # í•„ìš”ì— ë”°ë¼ 3.9, 3.10 ë“±ìœ¼ë¡œ íŠ¹ì • ë²„ì „ ì§€ì • ê°€ëŠ¥

      - name: ğŸ“ Generate Full README.md Content
        id: generate_content
        run: |
          README_PATH="README.md"
          REPO_NAME="davidkims/springboot" # ë¶„ì„í•  ì €ì¥ì†Œ ì´ë¦„

          # --- 1. README.mdì˜ í—¤ë” ë° ì†Œê°œ ë¶€ë¶„ ---
          echo "# ğŸš€ ${REPO_NAME} ê°œë°œ ì €ì¥ì†Œ" > "$README_PATH"
          echo "" >> "$README_PATH"
          echo "ì´ ì €ì¥ì†ŒëŠ” Spring Boot ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ì˜ˆì œ ë° ê´€ë ¨ ì›Œí¬í”Œë¡œìš°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤." >> "$README_PATH"
          echo "ì•„ë˜ ë‚´ìš©ì€ GitHub Actions ì›Œí¬í”Œë¡œìš°ì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„± ë° ê´€ë¦¬ë©ë‹ˆë‹¤." >> "$README_PATH"
          echo "" >> "$README_PATH"

          # --- 2. ê¹€ë³‘ê¶Œì˜ í”„ë¡œê·¸ë˜ë° ë¸”ë¡œê·¸ ì†Œê°œ ---
          echo "## ğŸ‘¨â€ğŸ’» ê¹€ë³‘ê¶Œì˜ í”„ë¡œê·¸ë˜ë° ë¸”ë¡œê·¸ ì†Œê°œ" >> "$README_PATH"
          echo "" >> "$README_PATH"
          echo "ì•ˆë…•í•˜ì„¸ìš”! ê¹€ë³‘ê¶Œì˜ í”„ë¡œê·¸ë˜ë° ë¸”ë¡œê·¸ëŠ” ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì£¼ì œì™€ ê¸°ìˆ  ìŠ¤íƒì— ëŒ€í•œ ê¹Šì´ ìˆëŠ” í†µì°°ê³¼ ì‹¤ìš©ì ì¸ ì˜ˆì œë¥¼ ê³µìœ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. íŠ¹íˆ ìŠ¤í”„ë§ ë¶€íŠ¸(Spring Boot), í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ê°œë°œ, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ë“± ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œì— ëŒ€í•œ ìœ ìš©í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§ì ‘ ê²½í—˜í•˜ê³  í•™ìŠµí•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ëœ ê¸€ë“¤ì€ ê°œë°œì ì—¬ëŸ¬ë¶„ì˜ ë¬¸ì œ í•´ê²°ê³¼ ì„±ì¥ì— í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤." >> "$README_PATH"
          echo "" >> "$README_PATH"
          echo "ğŸ‘‰ [ë¸”ë¡œê·¸ ë°©ë¬¸í•˜ê¸°](https://example.com/davidkims-blog) " >> "$README_PATH"
          echo "" >> "$README_PATH"

          # --- 3. ì›Œí¬í”Œë¡œìš° ì„¤ëª… ì„¹ì…˜ ---
          echo "## âš™ï¸ GitHub Actions ì›Œí¬í”Œë¡œìš°" >> "$README_PATH"
          echo "ì´ ì €ì¥ì†Œì—ëŠ” ê°œë°œ ë° ë°°í¬ ìë™í™”ë¥¼ ìœ„í•œ ë‹¤ìŒ GitHub Actions ì›Œí¬í”Œë¡œìš°ê°€ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:" >> "$README_PATH"
          echo "" >> "$README_PATH"

          # .github/workflows ë””ë ‰í† ë¦¬ì—ì„œ ëª¨ë“  .yml íŒŒì¼ì„ ì°¾ì•„ ë¶„ì„
          find .github/workflows -name "*.yml" | while IFS= read -r workflow_file; do
              WORKFLOW_NAME=$(grep "^name:" "$workflow_file" | head -n 1 | cut -d':' -f2- | xargs || echo "ì´ë¦„ ì—†ìŒ")
              WORKFLOW_SIZE=$(du -b "$workflow_file" | cut -f1)
              # ë§ˆì§€ë§‰ ì»¤ë°‹ ë‚ ì§œë¥¼ í•œêµ­ ì‹œê°„ìœ¼ë¡œ í¬ë§· (í˜„ì¬ ì‹œê°„: 2025ë…„ 06ì›” 05ì¼ 22ì‹œ 57ë¶„ 39ì´ˆ KST)
              LAST_UPDATED=$(git log -1 --format="%ad" --date=format:'%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„ %Sì´ˆ KST' "$workflow_file" 2>/dev/null || echo "ì •ë³´ ì—†ìŒ")
              
              echo "### âœ¨ ${WORKFLOW_NAME} (\`${workflow_file}\`)" >> "$README_PATH"
              echo "- **ìš©ëŸ‰:** ${WORKFLOW_SIZE} ë°”ì´íŠ¸" >> "$README_PATH"
              echo "- **ìµœì‹  ê°±ì‹ :** ${LAST_UPDATED}" >> "$README_PATH"
              echo "- **ì„¤ëª…:**" >> "$README_PATH"
              
              # ì›Œí¬í”Œë¡œìš° íŒŒì¼ ì´ë¦„ì— ë”°ë¥¸ ì„¤ëª… ì¶”ê°€ (ì˜ˆì‹œ)
              case "$(basename "$workflow_file")" in # íŒŒì¼ ì´ë¦„ë§Œìœ¼ë¡œ íŒë‹¨
                  "generate_full_readme.yml")
                      echo "  - ì´ ì›Œí¬í”Œë¡œìš°ëŠ” \`README.md\` íŒŒì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì €ì¥ì†Œì˜ íŒŒì¼ ë¶„ì„, ë¸”ë¡œê·¸ ì†Œê°œ, ì›Œí¬í”Œë¡œìš° ì •ë³´ ë“± ìµœì‹  ë‚´ìš©ì„ ë°˜ì˜í•©ë‹ˆë‹¤." >> "$README_PATH"
                      ;;
                  "db.yml") # ì´ ì›Œí¬í”Œë¡œìš° íŒŒì¼ ì´ë¦„ì— ë§ê²Œ ìˆ˜ì •
                      echo "  - ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ê¸°ì—… ê¸ˆìœµ ë°ì´í„°ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  ë°±ì—…í•©ë‹ˆë‹¤. ë°ì´í„° ì¶”ì¶œ, ì•”í˜¸í™”, OCI Object Storage ì—…ë¡œë“œ ë° NetBackup CLI ì‹¤í–‰ ì‹œë®¬ë ˆì´ì…˜ì„ í¬í•¨í•©ë‹ˆë‹¤." >> "$README_PATH"
                      ;;
                  *) # ê·¸ ì™¸ì˜ ì›Œí¬í”Œë¡œìš°
                      echo "  - ì´ ì›Œí¬í”Œë¡œìš°ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì„¤ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì›Œí¬í”Œë¡œìš° íŒŒì¼ì„ ê²€í† í•´ì£¼ì„¸ìš”." >> "$README_PATH"
                      ;;
              esac
              echo "" >> "$README_PATH"
          done

          # --- 4. NetBackup êµ¬ì„± ê°€ì´ë“œ ---
          echo "## ğŸ›¡ï¸ NetBackup êµ¬ì„± ê°€ì´ë“œ (ì‹œë®¬ë ˆì´ì…˜)" >> "$README_PATH"
          echo "ì´ ì €ì¥ì†Œì˜ ì›Œí¬í”Œë¡œìš°ëŠ” ë°±ì—… í”„ë¡œì„¸ìŠ¤ì˜ ì¼ë¶€ë¡œ NetBackup CLI ì‹¤í–‰ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤. ì‹¤ì œ í™˜ê²½ì—ì„œ NetBackupì„ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤:" >> "$README_PATH"
          echo "" >> "$README_PATH"
          echo "### ğŸ“¦ NetBackup ì„¤ì¹˜" >> "$README_PATH"
          echo "ì‹¤ì œ NetBackup ë°±ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ í•´ë‹¹ ì‹œìŠ¤í…œì— NetBackup í´ë¼ì´ì–¸íŠ¸ ë˜ëŠ” ë¯¸ë””ì–´ ì„œë²„ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì„¤ì¹˜ëŠ” Veritas ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•´ì£¼ì„¸ìš”." >> "$README_PATH"
          echo "" >> "$README_PATH"
          echo "### ğŸ“ í•„ìš”í•œ íŒŒì¼ ë° ë””ë ‰í† ë¦¬" >> "$README_PATH"
          echo "ì›Œí¬í”Œë¡œìš°ê°€ ë°±ì—… íŒŒì¼ì„ ìƒì„±í•˜ê³  ì´ë¥¼ NetBackupì´ ì¸ì‹í•  ìˆ˜ ìˆëŠ” ìœ„ì¹˜ì— ë‘ë ¤ë©´ ë‹¤ìŒì´ í•„ìš”í•©ë‹ˆë‹¤:" >> "$README_PATH"
          echo "- **ë°±ì—… ëŒ€ìƒ íŒŒì¼:** ì›Œí¬í”Œë¡œìš°ëŠ” \`output/corporate_banking_backup.sql\` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì´ë¥¼ ì•”í˜¸í™”í•˜ì—¬ \`output/corporate_banking_backup.zip\`ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤." >> "$README_PATH"
          echo "- **NetBackup ì„ì‹œ/ë¡œê·¸ ë””ë ‰í† ë¦¬:** NetBackup CLIê°€ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê±°ë‚˜ ì„ì‹œ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ ìˆëŠ” ë””ë ‰í† ë¦¬ (ì˜ˆ: \`/usr/openv/netbackup/logs\`)." >> "$README_PATH"
          echo "- **OCI CLI ì„¤ì • íŒŒì¼:** ì›Œí¬í”Œë¡œìš°ëŠ” \`~/.oci/oci_api_key.pem\` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ OCI Object Storage ì ‘ê·¼ì— ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì˜ ê¶Œí•œì€ \`600\`ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤." >> "$README_PATH"
          echo "" >> "$README_PATH"
          echo "### ğŸ”„ NetBackup CLI ì‹¤í–‰ ì˜ˆì‹œ" >> "$README_PATH"
          echo "ì›Œí¬í”Œë¡œìš° ë‚´ì—ì„œëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ê°€ ì‹œë®¬ë ˆì´ì…˜ë©ë‹ˆë‹¤. ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì ì ˆí•œ ê²½ë¡œì™€ ì˜µì…˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤." >> "$README_PATH"
          echo "\`\`\`bash" >> "$README_PATH"
          echo "bpbackup -f /path/to/output/corporate_banking_backup.zip -S <master_server> -L /path/to/log_file" >> "$README_PATH"
          echo "\`\`\`" >> "$README_PATH"
          echo "" >> "$README_PATH"

          # --- 5. ì €ì¥ì†Œ íŒŒì¼ ë¶„ì„ ë³´ê³ ì„œ ---
          echo "## ğŸ“Š ì €ì¥ì†Œ íŒŒì¼ ë¶„ì„ ë³´ê³ ì„œ" >> "$README_PATH"
          echo "ì´ ì„¹ì…˜ì€ ì €ì¥ì†Œ ë‚´ ì£¼ìš” íŒŒì¼ë“¤ì˜ ëª©ë¡ê³¼ ê¸°ë³¸ì ì¸ íŠ¹ì´ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤. (ì‹¬ì¸µì ì¸ ì½”ë“œ ë¶„ì„ì€ ì „ë¬¸ ë„êµ¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.)" >> "$README_PATH"
          echo "" >> "$README_PATH"

          # git ls-filesë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  íŒŒì¼ì„ ë‚˜ì—´í•˜ê³  ë¶„ì„ ë³´ê³ ì„œì— ì¶”ê°€
          git ls-files | while IFS= read -r file; do
              # ë¶„ì„ì—ì„œ ì œì™¸í•  ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ìœ í˜•
              if [[ "$file" == ".git/"* || "$file" == "target/"* || "$file" == "build/"* || "$file" == "src/main/resources/static/"* || "$file" == "node_modules/"* || "$file" == ".idea/"* || "$file" == "logs/"* || "$file" == "README.md" || ! -f "$file" ]]; then
                  continue
              fi

              FILE_SIZE=$(du -b "$file" | cut -f1)
              FILE_TYPE=$(file -b --mime-type "$file" 2>/dev/null || echo "unknown/type")

              echo "#### ğŸ“„ \`${file}\`" >> "$README_PATH"
              echo "- **íŒŒì¼ í¬ê¸°:** ${FILE_SIZE} ë°”ì´íŠ¸" >> "$README_PATH"
              echo "- **íŒŒì¼ íƒ€ì…:** \`${FILE_TYPE}\`" >> "$README_PATH"

              SPECIAL_NOTE="ìë™ ë¶„ì„ëœ íŠ¹ì´ì‚¬í•­ ì—†ìŒ. ìˆ˜ë™ ê²€í† ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              if [[ "$file" == *.java ]]; then
                  if grep -q "TODO" "$file" 2>/dev/null; then
                      SPECIAL_NOTE="TODO ì£¼ì„ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤."
                  fi
                  if grep -qE "System\.out\.print|e\.printStackTrace" "$file" 2>/dev/null; then
                      SPECIAL_NOTE+="\n  - ë””ë²„ê¹…ìš© ì¶œë ¥ ì½”ë“œ (System.out.print ë“±) ë˜ëŠ” ì˜ˆì™¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì¶œë ¥ (e.printStackTrace) ë°œê²¬ ê°€ëŠ¥ì„±. í”„ë¡œë•ì…˜ ì½”ë“œì—ì„œ ì œê±°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤."
                  fi
              elif [[ "$file" == *.xml || "$file" == *.properties || "$file" == *.yml || "$file" == *.yaml ]]; then
                  if grep -qE "password|secret|api_key" "$file" 2>/dev/null; then
                      SPECIAL_NOTE="ë¯¼ê° ì •ë³´(password, secret, api_key ë“±) í‚¤ì›Œë“œ ë°œê²¬ ê°€ëŠ¥ì„±. ì™¸ë¶€ ë…¸ì¶œì— ì£¼ì˜í•˜ê³  GitHub Secrets ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
                  fi
              elif [[ "$file" == *.sh || "$file" == *.bat ]]; then
                  SPECIAL_NOTE="ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤. ì‹¤í–‰ ê¶Œí•œ ë° ë³´ì•ˆì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤."
              elif [[ "$file" == *.md ]]; then
                  SPECIAL_NOTE="ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œì…ë‹ˆë‹¤."
              fi

              echo "- **íŠ¹ì´ì‚¬í•­:** ${SPECIAL_NOTE}" >> "$README_PATH"
              echo "" >> "$README_PATH"
          done

          # --- 6. ë³´ê³ ì„œ ìƒì„± ë‚ ì§œ ---
          echo "## ğŸ“… ë³´ê³ ì„œ ìƒì„± ë‚ ì§œ" >> "$README_PATH"
          echo "$(date '+%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„ %Sì´ˆ KST')" >> "$README_PATH"
          echo "" >> "$README_PATH"

          # ë³€ê²½ ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
          # í˜„ì¬ README.md íŒŒì¼ê³¼ gitì´ ì¶”ì í•˜ëŠ” README.md íŒŒì¼ ê°„ì˜ ì°¨ì´ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
          if git diff --exit-code --quiet "$README_PATH"; then
              echo "âœ… README.mdì— ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆëœ€."
              echo "has_changes=false" >> "$GITHUB_OUTPUT"
          else
              echo "ğŸ”„ README.mdê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì»¤ë°‹ ë° í‘¸ì‹œ ì¤€ë¹„ ì¤‘..."
              echo "has_changes=true" >> "$GITHUB_OUTPUT"
          fi

      - name: âš™ï¸ Configure Git
        # README.mdì— ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ê²½ìš°ì—ë§Œ Git ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.
        if: steps.generate_content.outputs.has_changes == 'true'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: â¬†ï¸ Commit and Push Changes
        # README.mdì— ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ê²½ìš°ì—ë§Œ ì»¤ë°‹ ë° í‘¸ì‹œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
        if: steps.generate_content.outputs.has_changes == 'true'
        run: |
          git add README.md
          git commit -m "Docs: Auto-generated README.md with comprehensive repository info"
          
          # --- ì¤‘ìš” ìˆ˜ì •: ë‹¤ë¥¸ ë³€ê²½ ì‚¬í•­ìœ¼ë¡œ ì¸í•œ í‘¸ì‹œ ê±°ë¶€ ì˜¤ë¥˜ í•´ê²° ---
          # ìµœì‹  ì›ê²© ë³€ê²½ ì‚¬í•­ì„ ê°€ì ¸ì™€ ë¡œì»¬ ë³€ê²½ ì‚¬í•­ì„ ê·¸ ìœ„ì— rebase í•©ë‹ˆë‹¤.
          # ì´ëŠ” 'remote rejected' ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê³  ê¹”ë”í•œ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
          git pull --rebase origin main 
          # ------------------------------------------------------------------

          # GITHUB_TOKENì„ ì‚¬ìš©í•˜ì—¬ ë³€ê²½ ì‚¬í•­ì„ í‘¸ì‹œí•©ë‹ˆë‹¤.
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
