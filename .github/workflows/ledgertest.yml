name: ğŸ’³ Auto Ledger Generation

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:

jobs:
  ledger:
    runs-on: ubuntu-latest
    env:
      IMAGE_NAME: finance-ledger-app

    steps:
      - name: ğŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“„ Create Java Source
        run: |
          cat <<EOF > VirtualLedgerGenerator.java
          import java.io.FileWriter;
          import java.io.IOException;
          import java.time.LocalDateTime;
          import java.util.Arrays;
          import java.util.List;

          public class VirtualLedgerGenerator {
              static class Transaction {
                  String type;
                  double amount;
                  String status;
                  String vendor;
                  public Transaction(String type, double amount, String status, String vendor) {
                      this.type = type;
                      this.amount = amount;
                      this.status = status;
                      this.vendor = vendor;
                  }
                  public String toLedgerLine() {
                      return LocalDateTime.now() + "," + type + "," + amount + "," + status + "," + vendor;
                  }
              }
              public static void main(String[] args) throws IOException {
                  List<Transaction> transactions = Arrays.asList(
                      new Transaction("check_card", 10000, "completed", "CU"),
                      new Transaction("credit_card", 20000, "completed", "Starbucks"),
                      new Transaction("stock", 500000, "buy", "Samsung"),
                      new Transaction("subscription", 17000, "completed", "Netflix"),
                      new Transaction("subscription", 26000, "completed", "ChatGPT")
                  );
                  FileWriter writer = new FileWriter("/ledger/transaction-ledger.csv");
                  for (Transaction tx : transactions) {
                      writer.write(tx.toLedgerLine() + "\\n");
                  }
                  writer.close();
                  System.out.println("ğŸ“„ Ledger created.");
              }
          }
          EOF

      - name: ğŸ“„ Create Dockerfile
        run: |
          cat <<EOF > Dockerfile
          FROM openjdk:17-alpine
          WORKDIR /app
          COPY VirtualLedgerGenerator.java .
          RUN javac VirtualLedgerGenerator.java
          RUN mkdir /ledger
          CMD ["java", "VirtualLedgerGenerator"]
          EOF

      - name: ğŸ›  Docker Build
        run: docker build -t $IMAGE_NAME .

      - name: ğŸ§¾ Ledger ìƒì„± ë° ì ì¬
        run: |
          mkdir -p ledger
          docker run --rm -v ${{ github.workspace }}/ledger:/ledger $IMAGE_NAME
          ls -l ledger

      - name: ğŸ—ƒ Upload Ledger Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ledger
          path: ledger/transaction-ledger.csv
